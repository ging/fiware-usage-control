version: '2'
services:
  flink-master:
    image: ging/flink-master:1.7.2-hadoop2.8
    hostname: flink-master
    container_name: flink-master
    environment:
      - IDM_URL=http://172.17.0.1:3000
      - CLIENT_ID=7b444e6d-b2e8-4536-b7fc-549b993beda2
      - CLIENT_SECRET=9a893545-dc0b-4ab5-9118-e46abf06bd3b
      - CALLBACK_URL=http://localhost/login
      - FLINK_PORT=8081
      - OAUTH_CLIENT_PORT=80
      - FLUENT_HOST=fluent
      - FLUENT_PORT=24224
#      - "constraint:node==<yourmasternode>"
    ports:
      - "8080:8080"
      - "8081:8081"
      - "80:80" # This is for the oauth client
    volumes:
      - access-token:/etc/oauth

  flink-worker:
    image: ging/flink-worker:1.7.2-hadoop2.8
    environment:
      - FLINK_MASTER_PORT_6123_TCP_ADDR=flink-master
      - FLUENT_HOST=fluent
      - FLUENT_PORT=24224
#     - FLINK_NUM_TASK_SLOTS=2
#    - "constraint:node==<yourworkernode>"
    depends_on:
      - flink-master
    volumes_from:
      - flink-master

volumes:
  access-token: