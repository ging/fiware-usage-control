version: '2'
services:
  flink-master:
    image: ging/flink-master:1.7.2-hadoop2.8
    hostname: flink-master
    container_name: flink-master
    environment:
      - IDM_URL=http://130.211.202.159:3000
      - CLIENT_ID=18d0cd90-8684-4e84-b806-c34f5d18ff02
      - CLIENT_SECRET=3d7f6a60-b681-445a-a496-8ffa6f9b4f97
      - CALLBACK_URL=http://104.198.175.134/login
      - FLINK_PORT=8081
      - OAUTH_CLIENT_PORT=80
      - FLUENT_HOST=35.188.118.73
      - FLUENT_PORT=24225
#      - "constraint:node==<yourmasternode>"
    ports:
      - "8080:8080"
      - "8081:8081"
      - "80:80" # This is for the oauth client
    volumes:
      - access-token:/etc/oauth

  flink-worker:
    image: ging/flink-worker:1.7.2-hadoop2.8
    environment:
      - FLINK_MASTER_PORT_6123_TCP_ADDR=flink-master
      - FLUENT_HOST=35.188.118.73
      - FLUENT_PORT=24225
#     - FLINK_NUM_TASK_SLOTS=2
#    - "constraint:node==<yourworkernode>"
    ports:
      - "9002:9002"
      - "9001:9001"
    depends_on:
      - flink-master
    volumes_from:
      - flink-master

volumes:
  access-token:
